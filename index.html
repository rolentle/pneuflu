<html>
  <head>
    <title>PneuFlu</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="datamaps.usa.min.js"></script>
    <script src="lib/bubble_builder.js"></script>
    <script src="lib/element_builder.js"></script>
    <script src="lib/data_formatter.js"></script>
  </head>
  <body>
    <h1>Pneumonia or Influenza Deaths in the 122 Largest Cities For 2014</h1>
    <h2 id="week_title"></h2>
    <span id="range_selector"></span>
    <div id="container" style="position: relative; width: 1000px; height: 600px;"></div>
    <script>

      d3.json('./data_2014.json',function(data){
        var fluData2014 = new fluData(data);
        var deaths_extent = fluData2014.death_extent_of_cities();

        var bubbleScale = d3.scale.linear()
          .domain(deaths_extent)
          .range(["white", "red"]);

        var death_min = deaths_extent[0];
        var death_max = deaths_extent[1];
        var death_mid = Math.round((death_max + death_min) / 22);
        fills_properties = {}
        fills_properties[death_min] = bubbleScale(death_min);
        fills_properties[death_mid] = bubbleScale(death_mid);
        fills_properties[death_max] = bubbleScale(death_max);
        var map = new Datamap({
          element: document.getElementById('container'),
          scope: 'usa',
          fills: fills_properties
        });

        var default_week_number = 1;
        var week_1_data = fluData2014.by_city_and_week_of(default_week_number);
        setTitle(default_week_number);
        setBubbles(map, week_1_data, bubbleScale);
        buildSelector(fluData2014, map, bubbleScale);
        fills_properties = {}
        fills_properties[death_min] = death_min;
        fills_properties[death_mid] = death_mid;
        fills_properties[death_max] = death_max;
        map.legend({
          legendTitle: "Total Deaths", 
          labels: fills_properties
        });
      });
    </script>
  </body>
</html>
